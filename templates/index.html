<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">

    <script>
    (function () {
        const theme = localStorage.getItem("theme");
        if (theme === "dark") {
            document.documentElement.classList.add("dark");
        }
    })();
    </script>

    <title>{{ nombre }} | Pok√©mon Aleatorio</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="card">
    <div class="header">
        <h1>üéÆ Pok√©mon Aleatorio</h1>
        <button id="theme-toggle" title="Cambiar modo">üåô</button>
    </div>

    <div class="pokemon-img">
        <img src="{{ imagen_url }}" alt="Pokemon">
    </div>

    <div class="name {% if es_legendario %}legendary{% endif %}">{{ nombre }}</div>

    <div class="badges">
        {% for tipo in tipos %}
            <div class="badge">{{ tipo }}</div>
        {% endfor %}
    </div>

    <div class="info">
        <strong>Generaci√≥n:</strong> {{ generacion }}
    </div>

    <div class="stats-box">
        <div class="stat">
            <div class="stat-label">üìè Altura</div>
            <div class="stat-value">{{ altura }} m</div>
        </div>
        <div class="stat">
            <div class="stat-label">‚öñÔ∏è Peso</div>
            <div class="stat-value">{{ peso }} kg</div>
        </div>
    </div>

    <div class="info">
        <strong>Mega evoluci√≥n:</strong>
        {% if mega_disponible %} ‚úÖ {% else %} ‚ùå {% endif %}
    </div>

    <div class="info">
        <strong>Legendario:</strong>
        {% if es_legendario %} ‚úÖ {% else %} ‚ùå {% endif %}
    </div>

    <div class="evo-tree">
        <h3>Cadena evolutiva</h3>

        {% for origen, ramas in evoluciones_por_origen.items() %}
            <div class="evo-node">

                {% if loop.first %}
                    <div class="pokemon-box evo-click" data-name="{{ origen }}">
                        {{ origen.capitalize() }}
                    </div>
                {% endif %}

                {% for evo in ramas %}
                    <div class="evo-lineal">
                        <div class="pokemon-box child evo-click" data-name="{{ evo.to }}">
                            {{ evo.to.capitalize() }}
                        </div>
                    </div>
                {% endfor %}

            </div>
        {% endfor %}
    </div>

    <form method="get">
        <button>üé≤ Nuevo Pok√©mon</button>
    </form>
</div>

<div id="modal-bg">
    <div id="modal-card">
        <img id="modal-img" src="">
        <h3 id="modal-name"></h3>
    </div>
</div>

<script>
const toggleBtn = document.getElementById("theme-toggle");
const body = document.body;

const savedTheme = localStorage.getItem("theme");
if (savedTheme === "dark") {
    document.documentElement.classList.add("dark");
    toggleBtn.textContent = "‚òÄÔ∏è";
}

toggleBtn.addEventListener("click", () => {
    document.documentElement.classList.toggle("dark");
    const isDark = document.documentElement.classList.contains("dark");
    toggleBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem("theme", isDark ? "dark" : "light");
});

document.addEventListener("click", async (e) => {
    const box = e.target.closest(".evo-click");
    if (!box) return;

    const name = box.dataset.name.toLowerCase();
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
    const data = await res.json();

    document.getElementById("modal-img").src =
        data.sprites.other["official-artwork"].front_default;

    document.getElementById("modal-name").textContent =
        name.charAt(0).toUpperCase() + name.slice(1);

    document.getElementById("modal-bg").style.display = "flex";
});

document.getElementById("modal-bg").addEventListener("click", e => {
    if (e.target.id === "modal-bg") {
        e.currentTarget.style.display = "none";
    }
});
</script>

</body>
</html>
